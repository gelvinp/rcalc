import os

Import("env")

env_modules = env.Clone()

Export("env_modules")

for name, path in env.module_list.items():
    env.modules_sources = []

    base_path = path if os.path.isabs(path) else name
    SConscript(base_path + "/SCsub")

    lib = env_modules.add_library("module_%s" % name, env.modules_sources)
    env.Prepend(LIBS=[lib])

env.modules_sources = []
env_modules.add_source_files(env.modules_sources, "register_modules.gen.cpp")
lib = env_modules.add_library("modules", env.modules_sources)
env.Prepend(LIBS=[lib])